<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Chef SolrCloud by vkhatri</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Chef SolrCloud</h1>
        <p>Chef cookbook to Manage Apache SolrCloud</p>
        <p class="view"><a href="https://github.com/vkhatri/chef-solrcloud">View the Project on GitHub <small>vkhatri/chef-solrcloud</small></a></p>
        <ul>
          <li><a href="https://github.com/vkhatri/chef-solrcloud/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/vkhatri/chef-solrcloud/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/vkhatri/chef-solrcloud">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="solrcloud-cookbook" class="anchor" href="#solrcloud-cookbook" aria-hidden="true"><span class="octicon octicon-link"></span></a>solrcloud Cookbook</h1>

<p><a href="https://travis-ci.org/vkhatri/chef-solrcloud"><img src="https://travis-ci.org/vkhatri/chef-solrcloud.svg?branch=master" alt="Build Status"></a></p>

<p>This is a <a href="https://www.getchef.com/chef/">Chef</a> cookbook for <a href="http://lucene.apache.org/solr/">Apache Solr</a>.</p>

<p>It was primarily developed for Testing SolrCloud against Solr Master/Slave setup and its features.</p>

<p>Currently it supports only in built Jetty based SolrCloud deployment, more
features and attributes will be added over time, <strong>feel free to contribute</strong>
what you find missing!</p>

<p>SolrCloud is the default deployment and Solr Master/Slave setup is not supported
by this cookbook.</p>

<h2>
<a id="repository" class="anchor" href="#repository" aria-hidden="true"><span class="octicon octicon-link"></span></a>Repository</h2>

<p><a href="http://vkhatri.github.io/chef-solrcloud">http://vkhatri.github.io/chef-solrcloud</a></p>

<h2>
<a id="supported-apache-solr-version" class="anchor" href="#supported-apache-solr-version" aria-hidden="true"><span class="octicon octicon-link"></span></a>Supported Apache Solr Version</h2>

<p>This cookbook was tested for Apache Solr v4.9.0 and v4.10.x.</p>

<h2>
<a id="supported-apache-solr-runtime" class="anchor" href="#supported-apache-solr-runtime" aria-hidden="true"><span class="octicon octicon-link"></span></a>Supported Apache Solr Runtime</h2>

<p>Currently this cookbook supports only Apache Solr in built <a href="http://wiki.apache.org/solr/SolrJetty">Jetty</a> based deployment.</p>

<h2>
<a id="supported-apache-solr-package-deployment" class="anchor" href="#supported-apache-solr-package-deployment" aria-hidden="true"><span class="octicon octicon-link"></span></a>Supported Apache Solr Package Deployment</h2>

<p>Currently this cookbook only supports Apache Solr Tarball based deployment.</p>

<h2>
<a id="supported-apache-solr-cluster-deployment" class="anchor" href="#supported-apache-solr-cluster-deployment" aria-hidden="true"><span class="octicon octicon-link"></span></a>Supported Apache Solr Cluster Deployment</h2>

<p>Currently this cookbook only support SolrCloud Cluster deployment. It does not
support Apache Solr Master/Slave Cluster deployment.</p>

<h2>
<a id="supported-jdk-versions" class="anchor" href="#supported-jdk-versions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Supported JDK Versions</h2>

<p>Check <a href="http://lucene.apache.org/solr/">Apache Solr</a> Documentation for JDK Version requirement for current Solr version, Oracle JDK 7 is recommended.</p>

<h2>
<a id="recipes" class="anchor" href="#recipes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Recipes</h2>

<ul>
<li><p><code>solrcloud::tarball</code>      - install solr package, directories and service</p></li>
<li><p><code>solrcloud::config</code>       - manages solr base configuration files</p></li>
<li><p><code>solrcloud::jetty</code>        - manages jetty base configuration files and directories</p></li>
<li>
<p><code>solrcloud::zkcli</code>        - setup zookeeper package for zookeeper client binary (zkCli.sh)</p>

<pre><code>zkcli recipe does not manage zookeeper server and its only purpose
is to have zookeeper client on all solr nodes
</code></pre>
</li>
<li>
<p><code>solrcloud::user</code>         - create solr service user</p>

<pre><code>solr user is better to be managed by a User management cookbook
instead of solrcloud for Production environment.
</code></pre>
</li>
<li><p><code>solrcloud::zkconfigsets</code> - create/delete solrcloud configSet in zookeeper via LWRP</p></li>
<li><p><code>solrcloud::collections</code>  - create/delete solrcloud collection on solrcloud node via LWRP</p></li>
</ul>

<blockquote>
<p><code>solrcloud::tarball</code> is the main recipe which includes all other recipe. For <code>run_list</code> use <code>solrcloud::tarball</code>.</p>
</blockquote>

<h2>
<a id="solrcloud-configset-zookeeper-configs-lwrp" class="anchor" href="#solrcloud-configset-zookeeper-configs-lwrp" aria-hidden="true"><span class="octicon octicon-link"></span></a>SolrCloud configSet (Zookeeper Configs) LWRP</h2>

<p><strong>LWRP - solrcloud_zkconfigset</strong></p>

<p>SolrCloud Zookeeper configSet is managed via LWRP - <code>solrcloud_zkconfigset</code>.</p>

<p>SolrCloud Zookeeper configSets management is enabled by default for all nodes.
It means all nodes will get the configSets and will try to manage it against
one of the configured zookeeper server via attribute <code>node[:solrcloud][:solr_config][:solrcloud][:zk_host]</code>.</p>

<pre><code>All the nodes communicate to a zookeeper cluster, hence attribute
`node[:solrcloud][:manage_zkconfigsets]` &amp; `node[:solrcloud][:manage_zkconfigsets_source]`
does not require to be enabled on all the nodes.
</code></pre>

<p>Check <code>Cookbook Advanced Attributes</code> section for attribute details.</p>

<p><strong>zookeeper configSet config changes</strong></p>

<p>LWRP handles config changes by itself. When any change is made to configSet content, configSet will re-upload configSet to zookeeper.</p>

<p><strong>LWRP example</strong></p>

<p><em>Create a configSet using LWRP:</em></p>

<pre><code>solrcloud_zkconfigset configset_name
  option option_name
end
</code></pre>

<p><em>Always re create/upload configSet even exists or no update to config files:</em></p>

<pre><code>solrcloud_zkconfigset configset_name
  force_upload true
  option option_name
end
</code></pre>

<p>OR</p>

<p>Set attribute <code>node[:solrcloud][:force_zkconfigsets_upload]</code> to true, which affects all the configSets as
resource attribute :force_upload defualt value is set to <code>node[:solrcloud][:force_zkconfigsets_upload]</code>.</p>

<p><em>Delete a configSet using LWRP:</em></p>

<pre><code>solrcloud_zkconfigset configset_name do
  action :delete
end
</code></pre>

<p><em>configSet via node attribute:</em></p>

<pre><code>"default_attributes": {
  "solrcloud": {
    "zkconfigsets": {
      "abc": {
        "action": "delete"
      },
      "xyz": {
        "option name": "option value"
      }
    }
  }
}
</code></pre>

<blockquote>
<p>configSets can either be configured in recipe using LWRP or using node attribute <code>node[:solrcloud][:zkconfigsets]</code>.</p>

<p>configSets defined using attribute <code>node[:solrcloud][:zkconfigsets]</code> does not require LWRP.</p>
</blockquote>

<p><strong>LWRP Options</strong></p>

<p>SolrCloud Zookeeper cmd Reference: <a href="https://cwiki.apache.org/confluence/display/solr/Command+Line+Utilities">https://cwiki.apache.org/confluence/display/solr/Command+Line+Utilities</a></p>

<p>Parameters:</p>

<ul>
<li>
<em>configset_name (required)</em>           - solrcloud zookeeper configSet name</li>
<li>
<em>action (optional)</em>                   - default :create, options: :create, :delete</li>
<li>
<em>user (optional)</em>                     - configSet directory user permission, default value <code>node[:solrcloud][:user]</code>
</li>
<li>
<em>group (optional)</em>                    - configSet directory group permission, default value <code>node[:solrcloud][:group]</code>
</li>
<li>
<em>solr_zkcli (optional)</em>               - solr in built zkcli.sh for configSet upconfig, default value <code>node[:solrcloud][:zookeeper][:solr_zkcli]</code>
</li>
<li>
<em>zkcli (optional)</em>                    - zookeeper client zkCli.sh, default value <code>node[:solrcloud][:zookeeper][:zkcli]</code>
</li>
<li>
<em>zkhost (optional)</em>                   - zookeeper server, default value <code>node[:solrcloud][:solr_config][:solrcloud][:zk_host].first</code>
</li>
<li>
<em>zkconfigsets_home (optional)</em>        - configSet directory to sore on solrcloud node, default value <code>node[:solrcloud][:zkconfigsets_home]</code>
</li>
<li>
<em>zkconfigsets_cookbook (optional)</em>    - configSet cookbook name, default value <code>node[:solrcloud][:zkconfigsets_cookbook]</code>
</li>
<li>
<em>manage_zkconfigsets (optional)</em> - manage configSet, default value <code>node[:solrcloud][:manage_zkconfigsets]</code>
</li>
<li>
<em>force_upload (optional)</em> - if set always upload configSet to zookeeper, default value <code>node[:solrcloud][:force_zkconfigsets_upload]</code>
</li>
</ul>

<p><strong>LWRP configSet source cookbook/location management</strong></p>

<p>All configSet content must be stored under <code>node[:solrcloud][:zkconfigsets_cookbook]</code>/files/default/config set name/conf/` if
not managed separately.</p>

<p>configSets source cookbook is default set to <code>solrcloud</code> and can be changed via attribute <code>node[:solrcloud][:zkconfigsets_cookbook]</code>.</p>

<p>If configSets are managed outside of the cookbook, configSet will only get uploaded in case it is missing in the zookeeper.
Any update to separately managed configSets are not propogated to zookeeper by default. However, one can use attribute
<code>node[:solrcloud][:force_zkconfigsets_upload]</code> to always upload the configSet regardless of the state.</p>

<blockquote>
<p>Setting attribute node[:solrcloud][:force_zkconfigsets_upload] or resource attribute :force_upload would always trigger configSet upload to zookeeper. It is better not to enable rsource attribute :force_upload, but instead better to use attribute node[:solrcloud][:force_zkconfigsets_upload] on limited set of nodes.</p>

<p>This may vary environment to environment.</p>
</blockquote>

<h2>
<a id="solrcloud-collection-lwrp" class="anchor" href="#solrcloud-collection-lwrp" aria-hidden="true"><span class="octicon octicon-link"></span></a>SolrCloud Collection LWRP</h2>

<p><strong>LWRP - solrcloud_collection</strong></p>

<p>SolrCloud collection is managed via LWRP - <code>solrcloud_collection</code>.</p>

<blockquote>
<p>Create/Delete Collection API does not require to run on all solrcloud cluster nodes, hence attribute</p>

<p><code>node[:solrcloud][:manage_collections]</code> does not require to be enabled on all the nodes.</p>
</blockquote>

<p>Check <code>Cookbook Advanced Attributes</code> section for attribute details.</p>

<p><strong>collection Update/Change</strong></p>

<p>collection LWRP only perform collection action=CREATE|DELETE|RELOAD and does not manage any UPDATE/change in the collection.</p>

<p>To make a change to a collection, first make the change in the LWRP or node attribute <code>node[:solrcloud][:collections][:collection_nam][:attribute_name]</code>
for respective attribute.</p>

<p>Once changes are made in Chef cookbook, perform collection UPDATE or respective action call to one of the solrcloud node.</p>

<p>UPDATE call could be tricky and is not managed by Chef to avoid any unexpected behavior.</p>

<p>Re-issuing same command could hinder solrcloud cluster setup and must be re-issued carefully.</p>

<p><strong>LWRP example</strong></p>

<p><em>Create a collection using LWRP:</em></p>

<pre><code>solrcloud_collection collection_name
  option option_name
end
</code></pre>

<p><em>Delete a collection using LWRP:</em></p>

<pre><code>solrcloud_collection collection_name do
  action :delete
end
</code></pre>

<p><em>Reload a collection using LWRP:</em></p>

<pre><code>solrcloud_collection collection_name do
  action :reload
end
</code></pre>

<p><em>collection via node attribute:</em></p>

<pre><code>"default_attributes": {
  "solrcloud": {
    "collections": {
      "abc": {
        "action": "delete"
      },
      "def": {
        "action": "reload"
      },
      "xyz": {
        "num_shards": "1",
        "name": "xyz",
        "replication_factor": "1",
        "collection_config_name": "xyz",
        "option name": "value"
      }
    }
  }
}
</code></pre>

<blockquote>
<p>collections can either be configured in recipe using LWRP or using node attribute <code>node[:solrcloud][:collections]</code>.</p>

<p>collections defined using attribute <code>node[:solrcloud][:collections]</code> does not require LWRP.</p>
</blockquote>

<p><strong>LWRP Options</strong></p>

<p>Collection API Reference: <a href="https://cwiki.apache.org/confluence/display/solr/Collections+API">https://cwiki.apache.org/confluence/display/solr/Collections+API</a></p>

<p>Parameters:</p>

<ul>
<li>
<em>collection_config_name</em> (required)           - solrcloud zookeeper configSet name</li>
<li>
<em>action</em> (optional)                           - default :create, options: :create, :delete, :reload</li>
<li>
<em>context_path</em> (optional)                     - solr context path, default value <code>node['solrcloud']['jetty_config']['context']['path']</code>
</li>
<li>
<em>num_shards</em> (optional)                       - collection API parameter numShards, default value 1</li>
<li>
<em>shards</em> (optional)                           - collection API parameter shards, default value nil</li>
<li>
<em>router_field</em> (optional)                     - collection API parameter router.field, default value nil</li>
<li>
<em>async</em> (optional)                            - collection API parameter async, default value nil</li>
<li>
<em>router_name</em> (optional)                      - collection API parameter router.name, default value nil</li>
<li>
<em>router_field</em> (optional)                     - collection API parameter router.field, default value nil</li>
<li>
<em>host</em> (optional)                             - collection API host, solrcloud node (self), default value <code>node[:ipaddress]</code>
</li>
<li>
<em>use_ssl</em> (optional)                      - collection API, use https, default value false</li>
<li>
<em>port</em> (optional)                             - collection API host port, solrcloud port, default value <code>node[:solrcloud][:port]</code>
</li>
<li>
<em>ssl_port_</em> (optional)                        - collection API host ssl port, default value <code>node[:solrcloud][:ssl_port]</code>
</li>
<li>
<em>create_node_set</em> (optional)                  - collection API parameter createNodeSet, default value nil</li>
<li>
<em>replication_factor</em> (optional)               - collection API parameter replicationFactor, default value 1</li>
<li>
<em>max_shards_per_node</em> (optional)              - collection API parameter maxShardsPerNode, default value nil</li>
<li>
<em>auto_add_replicas</em> (optional)                - collection API parameter autoAddReplicas, default value false</li>
</ul>

<h2>
<a id="cookbook-advanced-attributes" class="anchor" href="#cookbook-advanced-attributes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cookbook Advanced Attributes</h2>

<ul>
<li>
<p><code>default[:solrcloud][:manage_zkconfigsets]</code> (default: <code>true</code>): manages solrcloud configSets in zookeeper</p>

<p>This attribute should be enabled for limited nodes in solrcloud cluster if possible.</p>
</li>
<li>
<p><code>default[:solrcloud][:manage_zkconfigsets_source]</code> (default: <code>true</code>): manages solrcloud collections configSets source content directory</p>

<pre><code>This attribute should be enabled for limited nodes in solrcloud cluster if possible.
</code></pre>
</li>
<li>
<p><code>default[:solrcloud][:notify_zkconfigsets_upload]</code> (default: <code>true</code>): notify/triggers configSet upload to zookeeper upon create/update</p>

<pre><code>This attribute should be enabled for limited nodes in solrcloud cluster if possible.
</code></pre>
</li>
<li>
<p><code>default[:solrcloud][:manage_collections]</code> (default: <code>true</code>): if set true, manages solrcloud cluster collections</p>

<pre><code>This attribute should be enabled for limited nodes in solrcloud cluster if possible.
</code></pre>
</li>
<li><p><code>default[:solrcloud][:notify_restart]</code> (default: <code>false</code>): notify solr service restart on a solrcloud resource change like config file/template etc.</p></li>
<li><p><code>default[:solrcloud][:notify_restart_upgrade]</code> (default: <code>false</code>): notify solr service restart on version upgrade</p></li>
<li>
<p><code>default[:solrcloud][:restore_cores]</code> (default: <code>true</code>): restore older version solr cores configuration to newer version</p>

<pre><code>Note: Disable this option if reverting back to an old version. Before restoring the cores, new version cores directory content gets purged.

If there are changes in cores configuration between older and newer versions, only current(older) version cores configuration will presists.
</code></pre>
</li>
<li>
<p><code>default[:solrcloud][:zk_run]</code> (default: <code>false</code>): if true solr will start up with embedded zookeeper</p>

<pre><code>Note: Setting option `node[:solrcloud][:zk_run]` will remove solrcloud config zk_host from solr.xml, mainly meant for testing purpose
</code></pre>
</li>
<li><p><code>default[:solrcloud][:enable_jmx]</code> (default: <code>true</code>): enable jmx</p></li>
<li><p><code>default[:solrcloud][:port]</code> (default: <code>8983</code>): solr service port, must be (&gt;1024 for non root user)</p></li>
<li><p><code>default[:solrcloud][:ssl_port]</code> (default: <code>8984</code>): solr ssl service port (&gt;1024 for non root user)</p></li>
<li><p><code>default[:solrcloud][:enable_ssl]</code> (default: <code>true</code>): enable solr ssl connector</p></li>
<li><p><code>default[:solrcloud][:enable_request_log]</code> (default: <code>true</code>): enable request log</p></li>
<li>
<p><code>default[:solrcloud][:solr_config][:solrcloud][:zk_host]</code> (default: <code>[]</code>): zookeeper servers, e.g. <code>["server:port", "server:port"]</code></p>

<pre><code>With attribute `default[:solrcloud][:zk_run]`, this attribute will get local zookeeper server.
</code></pre>
</li>
<li><p><code>default[:solrcloud][:java_options]</code> (default: <code>[]</code>): java options</p></li>
<li>
<p><code>default[:solrcloud][:auto_java_memory]</code> (default: <code>true</code>): enable auto java memory allocation, sets java attribute <code>-Xmx</code> for <code>node[:solrcloud][:java_options]</code></p>

<pre><code>This option calculates maximum allowed memory (multiple of 1024) for java process with minimum system memory        reservation defined by attribute `node[:solrcloud][:auto_system_memory]`
</code></pre>
</li>
<li><p><code>default[:solrcloud][:auto_system_memory]</code> (default: <code>768</code>): memory to preserve for OS, required when attribute <code>default[:solrcloud][:auto_java_memory]</code> is set</p></li>
<li><p><code>default[:solrcloud][:install_java]</code> (default: <code>true</code>): setup java, disable to manage java outside of this cookbook</p></li>
<li><p><code>default[:solrcloud][:context_name]</code> (default: <code>solr</code>): default solr jetty context path value</p></li>
<li>
<p><code>default[:solrcloud][:force_zkconfigsets_upload]</code> (default: <code>false</code>): if set, zkconfigset lwrp will always execute configSet upload to zookeeper even configSet exists or there is no update. This option is useful when configSet source directory is managed separately.</p>

<pre><code>This attribute should be enabled for limited nodes in solrcloud cluster if possible.
</code></pre>
</li>
</ul>

<h2>
<a id="cookbook-core-attributes" class="anchor" href="#cookbook-core-attributes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cookbook Core Attributes</h2>

<ul>
<li><p><code>default[:solrcloud][:user]</code> (default: <code>solr</code>): solr service user</p></li>
<li><p><code>default[:solrcloud][:group]</code> (default: <code>solr</code>): solr service group</p></li>
<li><p><code>default[:solrcloud][:user_home]</code> (default: <code>nil</code>): solr service user home</p></li>
<li><p><code>default[:solrcloud][:setup_user]</code> (default: <code>true</code>): manage solr user for solr service using <code>solrcloud::user</code> cookbook</p></li>
<li><p><code>default[:solrcloud][:version]</code> (default: <code>4.10.2</code>): solr package version</p></li>
<li><p><code>default[:solrcloud][:zk_run_data_dir]</code> (default: <code>node[:solrcloud][:install_dir]/zookeeperdata</code>): embedded zookeeper data directory</p></li>
<li><p><code>default[:solrcloud][:zk_run_port]</code> (default: <code>2181</code>): embedded zookeeper port</p></li>
<li><p><code>default[:solrcloud][:install_dir]</code> (default: <code>/usr/local/solr</code>): jetty home directory - jetty.home</p></li>
<li>
<p><code>default[:solrcloud][:data_dir]</code> (default: <code>/opt/solr</code>): solr collection data directory - solr.data.dir</p>

<pre><code>solrconfig.xml for each configSet needs to set dataDir for this location usage, like:
  &lt;dataDir&gt;${solr.data.dir:}/collection name&lt;/dataDir&gt;
</code></pre>
</li>
<li><p><code>default[:solrcloud][:solr_home]</code> (default: <code>node[:solrcloud][:install_dir]/solr</code>): solr home</p></li>
<li><p><code>default[:solrcloud][:cores_home]</code> (default: <code>node[:solrcloud][:solr_home]/cores</code>): solr collection/core home</p></li>
<li><p><code>default[:solrcloud][:shared_lib]</code> (default: <code>node[:solrcloud][:install_dir]</code>/lib): solr default lib directory</p></li>
<li><p><code>default[:solrcloud][:config_sets]</code> (default: <code>node[:solrcloud][:solr_home]/configsets</code>): solr cores configSets directory</p></li>
<li><p><code>default[:solrcloud][:service_name]</code> (default: <code>solr</code>): solr service name</p></li>
<li><p><code>default[:solrcloud][:service_start_wait]</code> (default: <code>15</code>): solr server after start up wait time</p></li>
<li><p><code>default[:solrcloud][:dir_mode]</code> (default: <code>0755</code>): solr resource default directory</p></li>
<li><p><code>default[:solrcloud][:pid_dir]</code> (default: <code>/var/run/solr</code>): solr pid directory</p></li>
<li><p><code>default[:solrcloud][:log_dir]</code> (default: <code>/var/log/solr</code>): solr log directory</p></li>
<li><p><code>default[:solrcloud][:template_cookbook]</code> (default: <code>solrcloud</code>): solr template resources cookbook</p></li>
<li><p><code>default[:solrcloud][:zkconfigsets_cookbook]</code> (default: <code>solrcloud</code>): zookeeper configSet cookbook</p></li>
<li><p><code>default[:solrcloud][:zkconfigsets_home]</code> (default: <code>/usr/local/solr_zkconfigsets</code>): configs location for zookeeper configSet upconfig</p></li>
<li><p><code>default[:solrcloud][:zookeeper][:version]</code> (default: <code>3.4.6</code>): zookeeper package setup for zkCli.sh</p></li>
</ul>

<h2>
<a id="cookbook-ulimit-attributes" class="anchor" href="#cookbook-ulimit-attributes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cookbook Ulimit Attributes</h2>

<ul>
<li><p><code>default[:solrcloud][:limits][:memlock]</code> (default: <code>unlimited</code>): solr service user memory limit</p></li>
<li><p><code>default[:solrcloud][:limits][:nofile]</code> (default: <code>48000</code>): solr service user file limit</p></li>
<li><p><code>default[:solrcloud][:limits][:nproc]</code> (default: <code>unlimited</code>): solr service user process limit</p></li>
</ul>

<h2>
<a id="cookbook-log4jproperties-config-attributes" class="anchor" href="#cookbook-log4jproperties-config-attributes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cookbook log4j.properties Config Attributes</h2>

<ul>
<li><p><code>default[:solrcloud][:log4j][:level]</code> (default: <code>10MB</code>):  solr log threshold</p></li>
<li><p><code>default[:solrcloud][:log4j][:console]</code> (default: <code>false</code>): enable/disable CONSOLE log</p></li>
<li><p><code>default[:solrcloud][:log4j][:max_file_size]</code> (default: <code>10MB</code>):  maximum log file size</p></li>
<li><p><code>default[:solrcloud][:log4j][:max_backup_index]</code> (default: <code>10</code>): log files retention</p></li>
<li><p><code>default[:solrcloud][:log4j][:conversion_pattern]</code> (default: <code>'%d{ISO8601} [%t] %-5p %c{3} %x - %m%n'</code>): log conversion pattern</p></li>
</ul>

<h2>
<a id="cookbook-request-log-config-attributes" class="anchor" href="#cookbook-request-log-config-attributes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cookbook Request Log Config Attributes</h2>

<ul>
<li><p><code>default[:solrcloud][:request_log][:retain_days]</code> (default: <code>10</code>): request log files retention</p></li>
<li><p><code>default[:solrcloud][:request_log][:log_cookies]</code> (default: <code>false</code>):  enable log cookies</p></li>
<li><p><code>default[:solrcloud][:request_log][:time_zone]</code> (default: <code>UTC</code>): request log time zone</p></li>
</ul>

<h2>
<a id="cookbook-jetty-core-server-attributes" class="anchor" href="#cookbook-jetty-core-server-attributes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cookbook Jetty Core Server Attributes</h2>

<ul>
<li><p><code>default[:solrcloud][:jetty_config][:server][:min_threads]</code> (default: <code>10</code>): minimum jetty threads</p></li>
<li><p><code>default[:solrcloud][:jetty_config][:server][:max_threads]</code> (default: <code>10000</code>): maximum jetty threads</p></li>
<li><p><code>default[:solrcloud][:jetty_config][:server][:detailed_dump]</code> (default: <code>false</code>): enable jetty detailed dump</p></li>
</ul>

<h2>
<a id="cookbook-jetty-default-connector-attributes-orgeclipsejettyserverbiosocketconnector" class="anchor" href="#cookbook-jetty-default-connector-attributes-orgeclipsejettyserverbiosocketconnector" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cookbook Jetty Default Connector Attributes (org.eclipse.jetty.server.bio.SocketConnector)</h2>

<ul>
<li><p><code>default[:solrcloud][:jetty_config][:connector][:stats_on]</code> (default: <code>true</code>): enable statistics</p></li>
<li><p><code>default[:solrcloud][:jetty_config][:connector][:max_idle_time]</code> (default: <code>50000</code>): max idle time for connector (http)</p></li>
<li><p><code>default[:solrcloud][:jetty_config][:connector][:low_resource_max_idle_time]</code> (default: <code>1500</code>):</p></li>
</ul>

<h2>
<a id="cookbook-jetty-ssl-connector-attributes" class="anchor" href="#cookbook-jetty-ssl-connector-attributes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cookbook Jetty SSL Connector Attributes</h2>

<ul>
<li><p><code>default[:solrcloud][:jetty_config][:ssl_connector][:need_client_auth]</code> (default: <code>false</code>): enable client ssl authentication, this feature is not tested yet</p></li>
<li><p><code>default[:solrcloud][:jetty_config][:ssl_connector][:max_idle_time]</code> (default: <code>30000</code>): jetty ssl maximum idle time</p></li>
</ul>

<h2>
<a id="cookbook-jetty-ssl-key-store-attributes" class="anchor" href="#cookbook-jetty-ssl-key-store-attributes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cookbook Jetty SSL Key Store Attributes</h2>

<ul>
<li><p><code>default[:solrcloud][:key_store][:manage]</code> (default: <code>true</code>): generate key store for node key store attribute (enabled for testing purpose)</p></li>
<li><p><code>default[:solrcloud][:key_store][:key_store_file]</code> (default: <code>solr.keystore</code>): key store file name, file location - node.solrcloud.install_dir/resources/etc/</p></li>
<li><p><code>default[:solrcloud][:key_store][:key_store_password]</code> (default: ``): key store password</p></li>
<li><p><code>default[:solrcloud][:key_store][:cookbook]</code> (default: <code>solrcloud</code>): jetty ssl key store source cookbook, required is cookbook filekey store file management is disabled. Typical for Production environment.</p></li>
<li><p><code>default[:solrcloud][:key_store][:key_algo]</code> (default: <code>RSA</code>): key store Algorithm</p></li>
<li><p><code>default[:solrcloud][:key_store][:cn]</code> (default: <code>localhost</code>): key store CN</p></li>
<li><p><code>default[:solrcloud][:key_store][:ou]</code> (default: <code>ApacheSolrCloudTest</code>): key store OU</p></li>
<li><p><code>default[:solrcloud][:key_store][:o]</code> (default: <code>lucene.apache.org</code>): key store O</p></li>
<li><p><code>default[:solrcloud][:key_store][:c]</code> (default: <code>US</code>): key store C</p></li>
<li><p><code>default[:solrcloud][:key_store][:ext]</code> (default: <code>san=ip:127.0.0.1</code>): key store ext params</p></li>
<li><p><code>default[:solrcloud][:key_store][:validity]</code> (default: <code>999999</code>): key store validity</p></li>
</ul>

<h2>
<a id="cookbook-jetty-jmx-attributes" class="anchor" href="#cookbook-jetty-jmx-attributes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cookbook Jetty JMX Attributes</h2>

<ul>
<li><p><code>default[:solrcloud][:jmx][:port]</code> (default: <code>1099</code>): jmx port</p></li>
<li><del>`default[:solrcloud][:jmx][:ssl]` (default: `false`): this feature is not available yet and disabled</del></li>
<li><del>`default[:solrcloud][:jmx][:authenticate]` (default: `false`): enable jmx authentication and authorization, this feature is not tested yet</del></li>
<li><p><code>default[:solrcloud][:jmx][:users]</code> (default: <code>users - solrmonitor solrconfig</code>): jmx defaults users and roles, this feature is not tested yet</p></li>
</ul>

<h2>
<a id="cookbook-jetty-context-attributes" class="anchor" href="#cookbook-jetty-context-attributes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cookbook Jetty Context Attributes</h2>

<ul>
<li><p><code>default[:solrcloud][:jetty_config][:context][:path]</code> (default: <code>/solr</code>): solr default context path</p></li>
<li><p><code>default[:solrcloud][:jetty_config][:context][:temp_directory]</code> (default: <code>/solr-webapp</code>): solr webapp directory</p></li>
<li><p><code>default[:solrcloud][:jetty_config][:context][:war]</code> (default: <code>/webapps/solr.war</code>): jetty webapp solr war file location</p></li>
</ul>

<h2>
<a id="cookbook-solrxml-config-attributes" class="anchor" href="#cookbook-solrxml-config-attributes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cookbook solr.xml Config Attributes</h2>

<p>solr.xml Reference: <a href="https://cwiki.apache.org/confluence/display/solr/Format+of+solr.xml">https://cwiki.apache.org/confluence/display/solr/Format+of+solr.xml</a></p>

<ul>
<li><p><code>default[:solrcloud][:solr_config][:admin_handler]</code> (default: <code>org.apache.solr.handler.admin.CoreAdminHandler</code>): solr.xml solr param adminHandler</p></li>
<li><p><code>default[:solrcloud][:solr_config][:admin_path]</code> (default: <code>/solr/admin</code>): solr.xml param adminPath</p></li>
<li><p><code>default[:solrcloud][:solr_config][:core_load_threads]</code> (default: <code>3</code>): solr.xml solr param coreLoadThreads</p></li>
<li><p><code>default[:solrcloud][:solr_config][:core_root_directory]</code> (default: <code>node[:solrcloud][:cores_home]</code>): solr.xml solr param coreRootDirectory</p></li>
<li><p><code>default[:solrcloud][:solr_config][:shared_lib]</code> (default: <code>node[:solrcloud][:shared_lib]</code>): solr.xml solr param sharedLib</p></li>
<li><p><code>default[:solrcloud][:solr_config][:management_path]</code> (default: <code>nil</code>): solr.xml solr param managementPath</p></li>
<li><p><code>default[:solrcloud][:solr_config][:share_schema]</code> (default: <code>false</code>): solr.xml solr param shareSchema</p></li>
<li><p><code>default[:solrcloud][:solr_config][:transient_cache_size]</code> (default: <code>1000000</code>): solr.xml solr param transientCacheSize</p></li>
<li><p><code>default[:solrcloud][:solr_config][:solrcloud][:host_context]</code> (default: <code>solr</code>): solr.xml param solrcloud hostContext</p></li>
<li><p><code>default[:solrcloud][:solr_config][:solrcloud][:distrib_update_conn_timeout]</code> (default: <code>1000000</code>): solr.xml param solrcloud distribUpdateConnTimeout</p></li>
<li><p><code>default[:solrcloud][:solr_config][:solrcloud][:distrib_update_so_timeout]</code> (default: <code>1000000</code>): solr.xml param solrcloud distribUpdateSoTimeout</p></li>
<li><p><code>default[:solrcloud][:solr_config][:solrcloud][:leader_vote_wait]</code> (default: <code>1000000</code>): solr.xml param solrcloud leaderVoteWait</p></li>
<li><p><code>default[:solrcloud][:solr_config][:solrcloud][:zk_client_timeout]</code> (default: <code>15000</code>): solr.xml param solrcloud zkClientTimeout</p></li>
<li><p><code>default[:solrcloud][:solr_config][:solrcloud][:zk_host]</code> (default: <code>[]</code>): zookeeper servers, e.g. <code>["server:port", "server:port"]</code></p></li>
<li><p><code>default[:solrcloud][:solr_config][:solrcloud][:generic_core_node_names]</code> (default: <code>true</code>): solr.xml param solrcloud genericCoreNodeNames</p></li>
<li><p><code>default[:solrcloud][:solr_config][:shard_handler_factory][:socket_timeout]</code> (default: <code>0</code>): solr.xml param shardHandlerFactory socketTimeout</p></li>
<li><p><code>default[:solrcloud][:solr_config][:shard_handler_factory][:conn_timeout]</code> (default: <code>0</code>): solr.xml param shardHandlerFactory connTimeout</p></li>
<li><p><code>default[:solrcloud][:solr_config][:logging][:enabled]</code> (default: <code>false</code>): solr.xml param logging enabled, not required</p></li>
<li><p><code>default[:solrcloud][:solr_config][:logging][:logging_class]</code> (default: <code>nil</code>): solr.xml param logging class, not required </p></li>
<li><p><code>default[:solrcloud][:solr_config][:logging][:watcher][:logging_size]</code> (default: <code>1000</code>): solr.xml param logging size, not required</p></li>
<li><p><code>default[:solrcloud][:solr_config][:logging][:watcher][:threshold]</code> (default: <code>INFO</code>): solr.xml param logging threshold, no required</p></li>
</ul>

<h2>
<a id="cookbook-solrcloud-on-hdfs-config-attributes" class="anchor" href="#cookbook-solrcloud-on-hdfs-config-attributes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cookbook SolrCloud on HDFS Config Attributes</h2>

<ul>
<li><p><code>default[:solrcloud][:hdfs][:enable]</code> (default: <code>false</code>): to run solrcloud on hdfs, set it to <code>true</code></p></li>
<li><p><code>default[:solrcloud][:hdfs][:directory_factory]</code> (default: <code>HdfsDirectoryFactory</code>): solr hdfs directory factory</p></li>
<li><p><code>default[:solrcloud][:hdfs][:lock_type]</code> (default: <code>hdfs</code>): sold hdfs lock type</p></li>
<li><p><code>default[:solrcloud][:hdfs][:hdfs_home]</code> (default: <code>nil</code>): syntax: 'hdfs://host:port/path'</p></li>
</ul>

<blockquote>
<p>Note: SolrCloud on HDFS Deployment using this cookbook is not yet tested, check online <a href="https://cwiki.apache.org/confluence/display/solr/Running+Solr+on+HDFS">solr on hdfs</a> for more info</p>
</blockquote>

<h2>
<a id="cookbook-dependencies" class="anchor" href="#cookbook-dependencies" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cookbook Dependencies</h2>

<ul>
<li>
<code>ulimit</code> cookbook</li>
<li>
<code>java</code> cookbook</li>
</ul>

<h2>
<a id="solrcloud-deployment-requirement" class="anchor" href="#solrcloud-deployment-requirement" aria-hidden="true"><span class="octicon octicon-link"></span></a>SolrCloud Deployment Requirement</h2>

<p>To deploy solrcloud using this cookbook, below items are required:</p>

<ul>
<li>a zookeeper server or cluster</li>
<li>configSet(s) to upload to zookeeper for collection/core</li>
<li>collection(s) name to deploy in solrcloud</li>
</ul>

<h2>
<a id="solrcloud-configset-cookbook--environments--versioning" class="anchor" href="#solrcloud-configset-cookbook--environments--versioning" aria-hidden="true"><span class="octicon octicon-link"></span></a>SolrCloud configSet Cookbook / Environments / Versioning</h2>

<p><em>Directory Structure</em></p>

<p>SorlCloud configSet stored in zookeeper are configured as file resources.</p>

<p>Each configSet is stored under <code>node[:solrcloud][:zkconfigsets_cookbook]/files/default/configSet name</code>.</p>

<p>configSet folder follows the standard of having a <code>conf</code> folder with all the configuration files.</p>

<p>So, the directory structure will look like - <code>node[:solrcloud][:zkconfigsets_cookbook]/files/default/configSet name/conf</code>.</p>

<p><em>Managing same configSet for Multiple Environments</em></p>

<p>Managing configSet configuration across environments can be achieved in different ways, like</p>

<ul>
<li>maintain different <code>node[:solrcloud][:zkconfigsets_cookbook]</code> per environment
OR</li>
<li>maintain a single cookbook with versioning</li>
</ul>

<p>Simply, update <code>node[:solrcloud][:zkconfigsets_cookbook]</code> attribute with your configSet cookbook and update metadata.rb
file with line:</p>

<p>'depends <code>node[:solrcloud][:zkconfigsets_cookbook]</code>'.</p>

<h2>
<a id="single-node-solrcloud-test-cluster-deployment" class="anchor" href="#single-node-solrcloud-test-cluster-deployment" aria-hidden="true"><span class="octicon octicon-link"></span></a>Single Node SolrCloud Test Cluster Deployment</h2>

<p>Adjust the attributes according to your requirement. Below mentioned attributes
will work just fine for a single node solrcloud cluster.</p>

<pre><code>"default_attributes": {
  "solrcloud": {
    "zk_run": true,
    "port": "8080",
    "setup_user": true,
    "manager": true,
    "zkconfigsets": {
      "samplecollection": {}
    },
    "collections": {
      "samplecollection": {
        "collection_config_name": "samplecollection"
      }
    }
  }
}
</code></pre>

<h2>
<a id="multi-node-manager-attributes" class="anchor" href="#multi-node-manager-attributes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Multi Node Manager Attributes</h2>

<p>Below attributes are crucial for Multi Node Cluster. It is not advised to enable below solrcloud attributes on all
the nodes in the cluster. Like, each new node will trigger a zookeeper configset re-upload. Creating new collection
is better off maanged by one node to prevent a false collection state in the cluster.</p>

<pre><code>"default_attributes": {
  "solrcloud": {
    "manage_collections": true,
    "manage_zkconfigsets": true,
</code></pre>

<h2>
<a id="multi-node-solrcloud-test-cluster-deployment-with-zookeeper-cluster" class="anchor" href="#multi-node-solrcloud-test-cluster-deployment-with-zookeeper-cluster" aria-hidden="true"><span class="octicon octicon-link"></span></a>Multi Node SolrCloud Test Cluster Deployment with zookeeper Cluster</h2>

<p>Adjust the attributes according to your requirement. Below mentioned attributes
will work just fine for a single node solrcloud cluster.</p>

<pre><code>"default_attributes": {
  "solrcloud": {
    "solr_config": {
      "solrcloud": {
        "zk_host": [
          "zookeeper_ip:zookeeper_port"
        ]
      }
    },
    "port": "8080",
    "setup_user": true,
    "manage_collections": true,
    "manage_zkconfigsets": true,
    "zkconfigsets": {
      "samplecollection": {}
    },
    "collections": {
      "samplecollection": {
        "collection_config_name": "samplecollection"
      }
    }
  }
}
</code></pre>

<blockquote>
<p>Note: You might want to enable attribute <code>"manager": true</code> on limited cluster nodes. In a large
cluster, enabling this value on limited nodes would create less overhead for zookeeper.</p>
</blockquote>

<h2>
<a id="multi-node-solrcloud-test-cluster-deployment-with-embedded-zookeeper" class="anchor" href="#multi-node-solrcloud-test-cluster-deployment-with-embedded-zookeeper" aria-hidden="true"><span class="octicon octicon-link"></span></a>Multi Node SolrCloud Test Cluster Deployment with embedded zookeeper</h2>

<p>Adjust the attributes according to your requirement. Below mentioned attributes
will work just fine for a single node solrcloud cluster.</p>

<p>On <code>any one</code> of the cluster node, enable attribute <code>node[:solrcloud][:zk_run]</code> and use its ip address as zookeeper server.</p>

<pre><code>"default_attributes": {
  "solrcloud": {
    "solr_config": {
      "solrcloud": {
        "zk_host": [
          "instance_with_zk_run_ip:zookeeper_port_default_2181"
        ]
      }
    },
    "port": "8080",
    "setup_user": true,
    "zkconfigsets": {
      "samplecollection": {}
    },
    "collections": {
      "samplecollection": {
        "collection_config_name": "samplecollection"
      }
    }
  }
}
</code></pre>

<h2>
<a id="multiple-solrcloud-cluster-deployment" class="anchor" href="#multiple-solrcloud-cluster-deployment" aria-hidden="true"><span class="octicon octicon-link"></span></a>Multiple SolrCloud Cluster Deployment</h2>

<p>To deploy multiple clusters, simply create multiple roles with different zookeeper server or update
node attribute with respective cluster zookeeper server(s).</p>

<p>Zookeeper server attribute - <code>node[:solrcloud][:solr_config][:solrcloud][:zk_host]</code></p>

<h2>
<a id="solrcloud-on-hdfs-cluster-deployment" class="anchor" href="#solrcloud-on-hdfs-cluster-deployment" aria-hidden="true"><span class="octicon octicon-link"></span></a>SolrCloud on HDFS Cluster Deployment</h2>

<p>SolrCloud on HDFS has not been tested yet, but configuration from Apache Solr documentation has been
added to the cookbook.</p>

<h2>
<a id="tune-java-parameters-for-better-performance" class="anchor" href="#tune-java-parameters-for-better-performance" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tune Java Parameters for better Performance</h2>

<p>Some of the common java options tuning by <a href="https://wiki.apache.org/solr/ShawnHeisey">Shawn Heisey</a>.</p>

<p>Node attributes:</p>

<pre><code>"default_attributes": {
  "solrcloud": {
    "java_options": [
      "-Xms1024m",
      "-XX:+UseConcMarkSweepGC",
      "-XX:CMSInitiatingOccupancyFraction=75",
      "-XX:NewRatio=3",
      "-XX:MaxTenuringThreshold=8",
      "-XX:+CMSParallelRemarkEnabled",
      "-XX:+ParallelRefProcEnabled",
      "-XX:+AggressiveOpts"
    ]
  }
}
</code></pre>

<h2>
<a id="contributing" class="anchor" href="#contributing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributing</h2>

<ol>
<li>Fork the repository on Github</li>
<li>Create a named feature branch (like <code>add_component_x</code>)</li>
<li>Write your change</li>
<li>Write tests for your change (if applicable)</li>
<li>Run the tests (<code>rake</code>), ensuring they all pass</li>
<li>Write new resource/attribute description to <code>README.md</code>
</li>
<li>Write description about changes to PR</li>
<li>Submit a Pull Request using Github</li>
</ol>

<h2>
<a id="copyright--license" class="anchor" href="#copyright--license" aria-hidden="true"><span class="octicon octicon-link"></span></a>Copyright &amp; License</h2>

<p>Authors:: Virender Khatri and <a href="https://github.com/vkhatri/chef-solrcloud/graphs/contributors">Contributors</a></p>

<pre>
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
</pre>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/vkhatri">vkhatri</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>